class L{constructor(e){this.properties=e!=null?e:[]}get(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const r=this.get(e);if(r!==void 0){if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const r=this.get(e);if(r===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}getType(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const D="https://unpkg.com/@workadventure/scripting-api-extra@1.4.6/dist";class oe{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new L(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function N(o){const e=o?"#"+o.join():"";WA.nav.openCoWebSite(D+"/configuration.html"+e)}async function re(o,e){const t=await WA.room.getTiledMap(),r=new Map;return F(t.layers,r,o,e),r}function F(o,e,t,r){for(const n of o)if(n.type==="objectgroup"){for(const a of n.objects)if(a.type==="variable"||a.class==="variable"){if(!!t&&n.name!==t||!!r&&!r.includes(a.name))continue;e.set(a.name,new oe(a))}}else n.type==="group"&&F(n.layers,e,t,r)}let G;async function M(){return G===void 0&&(G=ne()),G}async function ne(){return ae(await WA.room.getTiledMap())}function ae(o){const e=new Map;return $(o.layers,"",e),e}function $(o,e,t){for(const r of o)r.type==="group"?$(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}async function se(){const o=await M(),e=[];for(const t of o.values())if(t.type==="objectgroup")for(const r of t.objects)(r.type==="area"||r.class==="area")&&e.push(r);return e}function ie(o){let e=1/0,t=1/0,r=0,n=0;const a=o.data;if(typeof a=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let s=0;s<o.height;s++)for(let i=0;i<o.width;i++)a[i+s*o.width]!==0&&(e=Math.min(e,i),n=Math.max(n,i),t=Math.min(t,s),r=Math.max(r,s));return{top:t,left:e,right:n+1,bottom:r+1}}function X(o){let e=1/0,t=1/0,r=0,n=0;for(const a of o){const s=ie(a);s.left<e&&(e=s.left),s.top<t&&(t=s.top),s.right>n&&(n=s.right),s.bottom>r&&(r=s.bottom)}return{top:t,left:e,right:n,bottom:r}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ue=Object.prototype.toString,P=Array.isArray||function(e){return ue.call(e)==="[object Array]"};function j(o){return typeof o=="function"}function le(o){return P(o)?"array":typeof o}function V(o){return o.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function _(o,e){return o!=null&&typeof o=="object"&&e in o}function ce(o,e){return o!=null&&typeof o!="object"&&o.hasOwnProperty&&o.hasOwnProperty(e)}var pe=RegExp.prototype.test;function fe(o,e){return pe.call(o,e)}var he=/\S/;function ge(o){return!fe(he,o)}var me={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function de(o){return String(o).replace(/[&<>"'`=\/]/g,function(t){return me[t]})}var ye=/\s*/,be=/\s+/,z=/\s*=/,Ae=/\s*\}/,We=/#|\^|\/|>|\{|&|=|!/;function ve(o,e){if(!o)return[];var t=!1,r=[],n=[],a=[],s=!1,i=!1,u="",p=0;function h(){if(s&&!i)for(;a.length;)delete n[a.pop()];else a=[];s=!1,i=!1}var y,A,R;function C(v){if(typeof v=="string"&&(v=v.split(be,2)),!P(v)||v.length!==2)throw new Error("Invalid tags: "+v);y=new RegExp(V(v[0])+"\\s*"),A=new RegExp("\\s*"+V(v[1])),R=new RegExp("\\s*"+V("}"+v[1]))}C(e||d.tags);for(var l=new k(o),W,m,b,S,x,w;!l.eos();){if(W=l.pos,b=l.scanUntil(y),b)for(var B=0,te=b.length;B<te;++B)S=b.charAt(B),ge(S)?(a.push(n.length),u+=S):(i=!0,t=!0,u+=" "),n.push(["text",S,W,W+1]),W+=1,S===`
`&&(h(),u="",p=0,t=!1);if(!l.scan(y))break;if(s=!0,m=l.scan(We)||"name",l.scan(ye),m==="="?(b=l.scanUntil(z),l.scan(z),l.scanUntil(A)):m==="{"?(b=l.scanUntil(R),l.scan(Ae),l.scanUntil(A),m="&"):b=l.scanUntil(A),!l.scan(A))throw new Error("Unclosed tag at "+l.pos);if(m==">"?x=[m,b,W,l.pos,u,p,t]:x=[m,b,W,l.pos],p++,n.push(x),m==="#"||m==="^")r.push(x);else if(m==="/"){if(w=r.pop(),!w)throw new Error('Unopened section "'+b+'" at '+W);if(w[1]!==b)throw new Error('Unclosed section "'+w[1]+'" at '+W)}else m==="name"||m==="{"||m==="&"?i=!0:m==="="&&C(b)}if(h(),w=r.pop(),w)throw new Error('Unclosed section "'+w[1]+'" at '+l.pos);return Te(we(n))}function we(o){for(var e=[],t,r,n=0,a=o.length;n<a;++n)t=o[n],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function Te(o){for(var e=[],t=e,r=[],n,a,s=0,i=o.length;s<i;++s)switch(n=o[s],n[0]){case"#":case"^":t.push(n),r.push(n),t=n[4]=[];break;case"/":a=r.pop(),a[5]=n[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(n)}return e}function k(o){this.string=o,this.tail=o,this.pos=0}k.prototype.eos=function(){return this.tail===""};k.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};k.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function T(o,e){this.view=o,this.cache={".":this.view},this.parent=e}T.prototype.push=function(e){return new T(e,this)};T.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var n=this,a,s,i,u=!1;n;){if(e.indexOf(".")>0)for(a=n.view,s=e.split("."),i=0;a!=null&&i<s.length;)i===s.length-1&&(u=_(a,s[i])||ce(a,s[i])),a=a[s[i++]];else a=n.view[e],u=_(n.view,e);if(u){r=a;break}n=n.parent}t[e]=r}return j(r)&&(r=r.call(this.view)),r};function g(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}g.prototype.clearCache=function(){typeof this.templateCache!="undefined"&&this.templateCache.clear()};g.prototype.parse=function(e,t){var r=this.templateCache,n=e+":"+(t||d.tags).join(":"),a=typeof r!="undefined",s=a?r.get(n):void 0;return s==null&&(s=ve(e,t),a&&r.set(n,s)),s};g.prototype.render=function(e,t,r,n){var a=this.getConfigTags(n),s=this.parse(e,a),i=t instanceof T?t:new T(t,void 0);return this.renderTokens(s,i,r,e,n)};g.prototype.renderTokens=function(e,t,r,n,a){for(var s="",i,u,p,h=0,y=e.length;h<y;++h)p=void 0,i=e[h],u=i[0],u==="#"?p=this.renderSection(i,t,r,n,a):u==="^"?p=this.renderInverted(i,t,r,n,a):u===">"?p=this.renderPartial(i,t,r,a):u==="&"?p=this.unescapedValue(i,t):u==="name"?p=this.escapedValue(i,t,a):u==="text"&&(p=this.rawValue(i)),p!==void 0&&(s+=p);return s};g.prototype.renderSection=function(e,t,r,n,a){var s=this,i="",u=t.lookup(e[1]);function p(A){return s.render(A,t,r,a)}if(!!u){if(P(u))for(var h=0,y=u.length;h<y;++h)i+=this.renderTokens(e[4],t.push(u[h]),r,n,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")i+=this.renderTokens(e[4],t.push(u),r,n,a);else if(j(u)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,n.slice(e[3],e[5]),p),u!=null&&(i+=u)}else i+=this.renderTokens(e[4],t,r,n,a);return i}};g.prototype.renderInverted=function(e,t,r,n,a){var s=t.lookup(e[1]);if(!s||P(s)&&s.length===0)return this.renderTokens(e[4],t,r,n,a)};g.prototype.indentPartial=function(e,t,r){for(var n=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!r)&&(a[s]=n+a[s]);return a.join(`
`)};g.prototype.renderPartial=function(e,t,r,n){if(!!r){var a=this.getConfigTags(n),s=j(r)?r(e[1]):r[e[1]];if(s!=null){var i=e[6],u=e[5],p=e[4],h=s;u==0&&p&&(h=this.indentPartial(s,p,i));var y=this.parse(h,a);return this.renderTokens(y,t,r,h,n)}}};g.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};g.prototype.escapedValue=function(e,t,r){var n=this.getConfigEscape(r)||d.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&n===d.escape?String(a):n(a)};g.prototype.rawValue=function(e){return e[1]};g.prototype.getConfigTags=function(e){return P(e)?e:e&&typeof e=="object"?e.tags:void 0};g.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!P(e))return e.escape};var d={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(o){E.templateCache=o},get templateCache(){return E.templateCache}},E=new g;d.clearCache=function(){return E.clearCache()};d.parse=function(e,t){return E.parse(e,t)};d.render=function(e,t,r,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+le(e)+'" was given as the first argument for mustache#render(template, view, partials)');return E.render(e,t,r,n)};d.escape=de;d.Scanner=k;d.Context=T;d.Writer=g;class Z{constructor(e,t){this.template=e,this.state=t,this.ast=d.parse(e)}getValue(){return this.value===void 0&&(this.value=d.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const r of this.getUsedVariables().values())t.push(this.state.onVariableChange(r).subscribe(()=>{const n=d.render(this.template,this.state);n!==this.value&&(this.value=n,e(this.value))}));return{unsubscribe:()=>{for(const r of t)r.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const r of e){const n=r[0],a=r[1],s=r[4];["name","&","#","^"].includes(n)&&t.add(a),s!==void 0&&typeof s!="string"&&this.recursiveGetUsedVariables(s,t)}}}async function Pe(){var o;const e=await se();for(const t of e){const r=(o=t.properties)!==null&&o!==void 0?o:[];for(const n of r){if(n.type==="int"||n.type==="bool"||n.type==="object"||typeof n.value!="string")continue;const a=new Z(n.value,WA.state);if(a.isPureString())continue;const s=a.getValue();await H(t.name,n.name,s),a.onChange(async i=>{await H(t.name,n.name,i)})}}}async function Ce(){var o;const e=await M();for(const[t,r]of e.entries())if(r.type!=="objectgroup"){const n=(o=r.properties)!==null&&o!==void 0?o:[];for(const a of n){if(a.type==="int"||a.type==="bool"||a.type==="object"||typeof a.value!="string")continue;const s=new Z(a.value,WA.state);if(s.isPureString())continue;const i=s.getValue();Q(t,a.name,i),s.onChange(u=>{Q(t,a.name,u)})}}}async function H(o,e,t){console.log(o),(await WA.room.area.get(o)).setProperty(e,t)}function Q(o,e,t){WA.room.setProperty(o,e,t),e==="visible"&&(t?WA.room.showLayer(o):WA.room.hideLayer(o))}let O,U=0,Y=0;function K(o){if(WA.state[o.name]){let e=o.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=o.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=o.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=o.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function Se(o){const e=o.properties.getString("openSound"),t=o.properties.getNumber("soundRadius");let r=1;if(t){const n=ee(o.properties.mustGetString("openLayer").split(`
`));if(n>t)return;r=1-n/t}e&&WA.sound.loadSound(e).play({volume:r})}function Le(o){const e=o.properties.getString("closeSound"),t=o.properties.getNumber("soundRadius");let r=1;if(t){const n=ee(o.properties.mustGetString("closeLayer").split(`
`));if(n>t)return;r=1-n/t}e&&WA.sound.loadSound(e).play({volume:r})}function J(o){return o.map(e=>O.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function ee(o){const e=J(o),t=X(e),r=((t.right-t.left)/2+t.left)*32,n=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(U-r,2)+Math.pow(Y-n,2))}function Ee(o){WA.state.onVariableChange(o.name).subscribe(()=>{WA.state[o.name]?Se(o):Le(o),K(o)}),K(o)}function Me(o,e,t,r){const n=o.name;let a,s,i=!1;const u=t.getString("tag");let p=!0;u&&!WA.player.tags.includes(u)&&(p=!1);const h=!!u;function y(){var l;a&&a.remove(),a=WA.ui.displayActionMessage({message:(l=t.getString("closeTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,A()}})}function A(){var l;a&&a.remove(),a=WA.ui.displayActionMessage({message:(l=t.getString("openTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,y()}})}function R(l){const W=X(J(e.properties.mustGetString("closeLayer").split(`
`)));s=WA.room.website.create({name:"doorKeypad"+l,url:r+"/keypad.html#"+encodeURIComponent(l),position:{x:W.right*32,y:W.top*32,width:32*3,height:32*4},allowApi:!0})}function C(){s&&(WA.room.website.delete(s.name),s=void 0)}WA.room.onEnterLayer(n).subscribe(()=>{if(i=!0,t.getBoolean("autoOpen")&&p){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(h&&!p||!h)&&(t.getString("code")||t.getString("codeVariable"))){R(n);return}!p||(WA.state[e.name]?y():A())}),WA.room.onLeaveLayer(n).subscribe(()=>{i=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),a&&a.remove(),C()}),WA.state.onVariableChange(e.name).subscribe(()=>{i&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&y(),s&&WA.state[e.name]===!0&&C(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&A())})}function ke(o){const e=o.properties.mustGetString("bellSound"),t=o.properties.getNumber("soundRadius");let r=1;if(t){const n=Math.sqrt(Math.pow(o.x-U,2)+Math.pow(o.y-Y,2));if(n>t)return;r=1-n/t}WA.sound.loadSound(e).play({volume:r})}function Re(o){WA.state[o.name]===void 0&&(WA.state[o.name]=0),WA.state.onVariableChange(o.name).subscribe(()=>{WA.state[o.name]&&ke(o)})}function xe(o,e,t){let r;const n=e.getString("bellPopup");WA.room.onEnterLayer(t).subscribe(()=>{var a;n?r=WA.ui.openPopup(n,"",[{label:(a=e.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[o]=WA.state[o]+1}}]):WA.state[o]=WA.state[o]+1}),WA.room.onLeaveLayer(t).subscribe(()=>{r&&(r.close(),r=void 0)})}async function Be(o){o=o!=null?o:D;const e=await re();O=await M();for(const t of e.values())t.properties.get("door")&&Ee(t),t.properties.get("bell")&&Re(t);for(const t of O.values()){const r=new L(t.properties),n=r.getString("doorVariable");if(n&&t.type==="tilelayer"){const s=e.get(n);if(s===void 0)throw new Error('Cannot find variable "'+n+'" referred in the "doorVariable" property of layer "'+t.name+'"');Me(t,s,r,o)}const a=r.getString("bellVariable");a&&xe(a,r,t.name)}WA.player.onPlayerMove(t=>{U=t.x,Y=t.y})}function Ge(o,e){const t=o.getString("bindVariable");if(t){const r=o.get("enterValue"),n=o.get("leaveValue"),a=o.getString("triggerMessage"),s=o.getString("tag");Ve(t,e,r,n,a,s)}}function Ve(o,e,t,r,n,a){a&&!WA.player.tags.includes(a)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{n||(WA.state[o]=t)}),r!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[o]=r}))}async function Ie(){const o=await M();for(const e of o.values()){const t=new L(e.properties);Ge(t,e.name)}}let q;async function Oe(o){const e=await WA.room.getTiledMap();o=o!=null?o:D,q=await M();const t=e.layers.find(r=>r.name==="configuration");if(t){const n=new L(t.properties).getString("tag");(!n||WA.player.tags.includes(n))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(o+"/configuration.html",!0)});for(const a of q.values()){const s=new L(a.properties),i=s.getString("openConfig");i&&a.type==="tilelayer"&&De(i.split(","),a.name,s)}}}function De(o,e,t){let r;const n=t.getString("openConfigAdminTag");let a=!0;n&&!WA.player.tags.includes(n)&&(a=!1);function s(){var u;r&&r.remove(),r=WA.ui.displayActionMessage({message:(u=t.getString("openConfigTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE or touch here to configure",callback:()=>N(o)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const u=t.getString("openConfigTrigger");a&&(u&&u==="onaction"?s():N(o))}),WA.room.onLeaveLayer(e).subscribe(()=>{r&&r.remove(),i()})}function je(){return WA.onInit().then(()=>{Be().catch(o=>console.error(o)),Ie().catch(o=>console.error(o)),Oe().catch(o=>console.error(o)),Ce().catch(o=>console.error(o)),Pe().catch(o=>console.error(o))}).catch(o=>console.error(o))}console.log("Script started successfully");let c;WA.onInit().then(()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const o=WA.room.mapURL,t={url:o.substring(0,o.lastIndexOf("/"))+"/information.html",visible:!0,allowApi:!0,allowPolicy:"",position:{vertical:"top",horizontal:"middle"},size:{width:"800px",height:"200px"}},r="Asking for a clue will cost you 1 minute.",n="You have to start over. This may be due to data corruption or you are trying to cheat ^^";let a=!1;WA.room.onEnterLayer("cigarette").subscribe(()=>{WA.state.CigaretteVisible&&(c=WA.ui.openPopup("cigarettePopup","A cigarette left on the ground. There is a trash can for that, but this person was obviously in a hurry.",[]),a=!0,WA.state.CigaretteVisible=!1)}),WA.room.onLeaveLayer("cigarette").subscribe(f),WA.room.area.onEnter("garbageCan").subscribe(()=>{a&&!WA.state.CigaretteComplete&&(c=WA.ui.openPopup("garbageCanPopup","You throw the cigarette in the garbage can. Thank you.",[]),WA.state.CigaretteComplete=!0)}),WA.room.area.onLeave("garbageCan").subscribe(f),WA.room.area.onEnter("info").subscribe(()=>{c=WA.ui.openPopup("infoPopup",`The goal is to enter all together in the train n\xB01 and to start it in order to escape!
The door can only be opened by the robot in front of the door if you complete all the riddles.`,[])}),WA.room.area.onLeave("info").subscribe(f),WA.room.area.onEnter("game").subscribe(()=>{c=WA.ui.openPopup("gamePopup","I'm playing Tic-tac-toe but I'm tired of playing against this robot. Can you try to win the game with circles?",[]),WA.state.TicTacToeStarted=!0}),WA.room.area.onLeave("game").subscribe(f),WA.room.onEnterLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToeOngoing=!0,WA.room.setProperty("tic-tac-toe","silent",!0))}),WA.room.onLeaveLayer("tic-tac-toe").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToeOngoing=!1)}),WA.room.onEnterLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay1=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay2)}),WA.room.onLeaveLayer("tic-tac-toe-play1").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay1=!1)}),WA.room.onEnterLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeStarted&&(WA.state.TicTacToePlay2=!0,WA.state.TicTacToeComplete=WA.state.TicTacToePlay1)}),WA.room.onLeaveLayer("tic-tac-toe-play2").subscribe(()=>{WA.state.TicTacToeComplete||(WA.state.TicTacToePlay2=!1)}),WA.chat.onChatMessage(s=>{WA.state.QuestionOngoing&&(WA.state.QuestionComplete=s=="46",WA.state.QuestionComplete?(WA.chat.sendChatMessage("Correct. You can now enter.","KindRobot000"),WA.state.TrainDoorOpen=!0):(WA.chat.sendChatMessage("Incorrect. You now have to start all over again.","KindRobot000"),WA.state.TicTacToeStarted=!1,WA.state.TicTacToeOngoing=!1,WA.state.TicTacToePlay1=!1,WA.state.TicTacToePlay2=!1,WA.state.TicTacToeComplete=!1,WA.state.CigaretteVisible=!0,a=!1,WA.state.CigaretteComplete=!1,WA.state.QuestionOngoing=!1,WA.state.QuestionComplete=!1,WA.state.TrainDoorOpen=!1))}),WA.room.area.onEnter("room1bot").subscribe(()=>{WA.state.QuestionComplete||(WA.state.TicTacToeComplete&&WA.state.CigaretteComplete?(WA.chat.sendChatMessage("Mr Robot: Type your answer here, but think carefully! If you make a mistake you will have to start all over again","KindRobot000"),WA.state.QuestionOngoing=!0):c=WA.ui.openPopup("room1botPopup","Mr Robot: Stranger, I'll block the access to this train until you prove your worth. "+r,[{label:"Give me a clue",className:"primary",callback:()=>I(1)}]))}),WA.room.area.onLeave("room1bot").subscribe(f),WA.room.area.onEnter("goToDriverCabine").subscribe(()=>{WA.nav.goToRoom("#driver-cabine");const s=137*32,i=16*32;WA.camera.set(s,i,500,500,!1,!0)}),WA.room.onEnterLayer("driver-cabine").subscribe(()=>{WA.state.TrainDoorOpen||(WA.controls.disablePlayerControls(),c=WA.ui.openPopup("driverCabinePopup",n,[]))}),WA.room.area.onEnter("room2bot").subscribe(()=>{WA.state.TrainStarted||(c=WA.ui.openPopup("room2botPopup","Stranger, it seems this train is not going to start until you find the right key. "+r,[{label:"Give me a clue",className:"primary",callback:()=>I(2)}]))}),WA.room.area.onLeave("room2bot").subscribe(f),WA.room.area.onEnter("room2coffee").subscribe(()=>{c=WA.ui.openPopup("room2coffeePopup","You found a cup of coffee. Studies have shown that the optimal consumption for healthy adults is 3 cups of coffee.",[])}),WA.room.area.onLeave("room2coffee").subscribe(f),WA.room.area.onEnter("room2pretzel").subscribe(()=>{c=WA.ui.openPopup("room2pretzelPopup","You found a Pretzel. Given the size of this Pretzel, 1 is more than enough for breakfast!",[])}),WA.room.area.onLeave("room2pretzel").subscribe(f),WA.room.area.onEnter("room2oldMap").subscribe(()=>{c=WA.ui.openPopup("room2oldMapPopup","You found an old map. It is very rare. Only 8 like this one exist in the world!",[])}),WA.room.area.onLeave("room2oldMap").subscribe(f),WA.room.area.onEnter("room2coins").subscribe(()=>{c=WA.ui.openPopup("room2coinsPopup","You found some coins. 5 more and you might be able to trade them for a bank bill.",[])}),WA.room.area.onLeave("room2coins").subscribe(f),WA.room.onEnterLayer("teleportRoom3").subscribe(()=>{WA.state.TrainStarted&&(c=WA.ui.openPopup("teleportRoom3Popup","Now that the train can start, you can go to the next room!",[{label:"Teleport",className:"primary",callback:()=>{WA.nav.goToRoom("#max-maulwurf");const s=241*32,i=27*32;WA.camera.set(s,i,500,500,!1,!0)}}]))}),WA.room.onLeaveLayer("teleportRoom3").subscribe(f),WA.room.onEnterLayer("max-maulwurf").subscribe(()=>{WA.state.TrainStarted||(WA.controls.disablePlayerControls(),c=WA.ui.openPopup("room3Popup",n,[]))}),WA.room.onLeaveLayer("max-maulwurf").subscribe(f),WA.room.area.onEnter("trainRoom3").subscribe(()=>{c=WA.ui.openPopup("room3Popup","Oops, looks like the train has been stopped immediately! Investigate the area to find out what happened.",[])}),WA.room.area.onLeave("trainRoom3").subscribe(f),WA.room.area.onEnter("room3bot").subscribe(()=>{WA.state.isMaxHappy||(c=WA.ui.openPopup("room3botPopup","Stranger, it seems your beloved Max Maulwurf is hungry. You will be blocked here until you comfort him. "+r,[{label:"Give me a clue",className:"primary",callback:()=>I(3)}]))}),WA.room.area.onLeave("room3bot").subscribe(f),WA.room.area.onEnter("room3helmet").subscribe(()=>{c=WA.ui.openPopup("room3helmetPopup","You found the yellow work helmet! This should help to calm down Max Maulwurf.",[]),WA.state.helmetFound=!0}),WA.room.area.onLeave("room3helmet").subscribe(f),WA.room.area.onEnter("room3DBtrophy").subscribe(()=>{c=WA.ui.openPopup("room3DBtrophyPopup","You found the DB trophy! This should help to calm down Max Maulwurf.",[]),WA.state.DBtrophyFound=!0}),WA.room.area.onLeave("room3DBtrophy").subscribe(f),WA.room.area.onEnter("room3WAmug").subscribe(()=>{c=WA.ui.openPopup("room3WAmugPopup","You found the WorkAdventure coffee mug! This should help to calm down Max Maulwurf.",[]),WA.state.WAmugFound=!0}),WA.room.area.onLeave("room3WAmug").subscribe(f),WA.room.area.onEnter("maxMaulwurf").subscribe(()=>{WA.state.powerRestarted?c=WA.ui.openPopup("maxMaulwurfPopup","Thank you all for fixing the train station!",[]):WA.state.WAmugFound&&WA.state.helmetFound&&WA.state.DBtrophyFound?(WA.room.hideLayer("maxHungry"),WA.room.showLayer("maxHappy"),c=WA.ui.openPopup("maxMaulwurfPopup","You give the 3 items to Max. After receiving all the items, he calms down and pauses while looking at his beloved helmet. He remembers his time in DB: his main task was to inform about construction and repairs... He apologizes and agrees to power ON the power supply. Hurry and restart the train traffic control system at the terminal to avoid further delays!",[]),WA.state.isMaxHappy=!0):c=WA.ui.openPopup("maxMaulwurfPopup","Max looks hungry... it seems he is the one who caused the damage in the power station because he's mad that he's no longer the railroad mascot.",[])}),WA.room.area.onLeave("maxMaulwurf").subscribe(f),WA.room.area.onEnter("terminal").subscribe(()=>{WA.state.isMaxHappy?WA.state.powerRestarted?WA.nav.openCoWebSite(WA.state.formURL):c=WA.ui.openPopup("terminalPopup","Looks like you need to restart the system to finish your mission!",[{label:"RESTART",className:"primary",callback:()=>Ye()}]):c=WA.ui.openPopup("terminalPopup","This is the terminal... but it is out of service.",[])}),WA.room.area.onLeave("terminal").subscribe(()=>{Ue()}),je().then(()=>{console.log("Scripting API Extra ready");const s=WA.state.onVariableChange("GameStarted").subscribe(i=>{i===!0&&(WA.ui.website.open(t),s.unsubscribe(),f(),WA.controls.restorePlayerControls())});WA.state.onVariableChange("TicTacToeComplete").subscribe(i=>{i===!0&&(WA.state.QuestionReady=WA.state.CigaretteComplete)}),WA.state.onVariableChange("CigaretteComplete").subscribe(i=>{i===!0&&(WA.state.QuestionReady=WA.state.TicTacToeComplete)}),WA.state.GameStarted===!1?(WA.controls.disablePlayerControls(),c=WA.ui.openPopup("startPopup","You have just landed in an abandoned train station. By clicking on ESCAPE the 20 minutes timer will start.",[{label:"ESCAPE",className:"error",callback:()=>{WA.state.GameStarted=!0,f(),WA.controls.restorePlayerControls()}}])):WA.ui.website.open(t)}).catch(s=>console.error(s))}).catch(o=>console.error(o));function f(){c!==void 0&&(c.close(),c=void 0)}async function Ue(){f(),(await WA.nav.getCoWebSites()).length&&WA.nav.closeCoWebSite()}function I(o){let e="";for(let t=1;t<4;t++)if(e=`Room${o}Clue${t}`,WA.state.loadVariable(e)===!1){WA.state.saveVariable(e,!0);return}}function Ye(){f(),WA.state.powerRestarted=!0,WA.nav.openCoWebSite(WA.state.formURL)}
